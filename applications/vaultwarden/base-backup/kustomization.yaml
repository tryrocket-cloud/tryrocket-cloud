apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - backup-cronjob.yaml
  
  - backup-role.yaml
  - backup-rolebinding.yaml
  - backup-sa-token.yaml
  - backup-sa.yaml
  
  # move to vault
  - https://gitea.tryrocket.cloud/tryrocket-cloud/vaultwarden//?ref=main
  
  # TODO: kubeconfig.yaml as secret from vault
  # TODO: ssh-config      as secret from vault
  # TODO: ssh-hosts       as secret from vault
  # TODO: ssh-privatekey  as secret from vault

  #- hetzner-subaccount-ssh-config-external-secret.yaml TODO: enable it
  #- hetzner-subaccount-ssh-privatekey-external-secret.yaml TODO: enable it
  
  - healthchecks-external-secret.yaml
  - restic-external-secret.yaml

configMapGenerator:
  - name: pgdump-config
    literals:
      - PGHOST=postgres.postgres-16.svc.cluster.local
      - PGPORT=5432
      - PGDATABASE=vaultwarden
      - PGTZ=Europe/Berlin

  - name: restic-config
    literals:
      - RESTIC_REPOSITORY=sftp:storagebox:/home/test-backup
